# Roadmap — v1.2 (中期里程碑)

版本目标（目标时间：2026 Q2 预估）
- 目标：把用户在日常使用中最明显的性能与可观测性问题解决掉，同时为后续的微内核化与语义引擎 DLC 做好工程基础（测试、类型检查、模块边界）。
- 指标（成功衡量）：
  - GUI 在处理 200MB~1GB 日志时卡顿降低至 <500ms 频次显著减少（smoke test）
  - 正则处理模块基准性能提高 2x（常见场景）
  - CI 持续集成覆盖关键单元测试，mypy 通过率 > 95%

为何优先做这些
- 这些项直接影响日常可用性（Ops/Support 投诉最多的点）并且是后续架构改造（mca_lib/Asyncio）的前置条件。

关键里程碑与可交付项

1) v1.2.1 — 基线性能与线程化改造（优先级：高，估时：3-6 周）
   - 拆分 `app.py`：View / Controller / Service（可并行拆分，估时 2 周）
   - 把主线程 I/O（文件读写/解析）迁移到 Worker Thread 或 asyncio（估时 1-2 周）
   - Acceptance: GUI 报读 500MB 日志，主界面无阻塞 > 2s；提供性能回归测试脚本
   - 风险：老插件依赖同步行为，需提供兼容适配层

2) v1.2.2 — 模块化与测试覆盖（优先级：高，估时：2-3 周）
   - 为 `crash_patterns.py` 编写单元测试与基准测试（benchmarks）
   - 预编译常用正则并加入基准对比（报告）
   - 目标：在 CI 中引入基准 test（或 nightly benchmark job）

3) v1.2.3 — 类型与代码质量（优先级：中，估时：1-2 周）
   - 补齐类型注解（逐模块推进），修复 mypy 报错，目标通过率 > 95%
   - 开始对关键模块引入更严格的 linters（flake8 / ruff）

4) v1.2.4 — 可观察性与运维支持（优先级：中，估时：2 周）
   - 引入 Prometheus metrics（关键服务/函数计数与延时）与基本健康检查
   - 增加 tracing hook（OpenTelemetry），以便在线下复现复杂问题

5) v1.2.5 — 核心差异化：AI 做不到的“现场级”诊断（优先级：高，估时：2 周）
   - 痛点：通用 AI（网页版）可以通过日志分析错误，但它**无法读取用户本地文件**，也无法**自动监控**。
   - 策略：放弃与 AI 比拼“阅读理解”，转攻**环境感知**与**自动化**。
     1. **全盘扫描 (Deep Scan)**：不仅读日志，还要扫描 `mods/` 文件夹。
        - *AI 盲区*：日志只说 `ClassNotDef`, AI 只能猜“也许缺了前置”。MCA 可以直接扫描硬盘，精准指出“缺了 Lib-A-1.2.jar”。
     2. **多源取证 (Multi-Source Analysis)**：重新定义“日志分析”。
        - *不仅是文本*：当 `latest.log` 因为崩溃截断或没写出来时，分析器会自动读取 **Windows 事件日志 (Event Logs)** 或 **JVM 崩溃日志 (hs_err_pid.log)**。
        - *解决 OOM*：通过分析系统日志中的 `Resource-Exhaustion` 事件，像法医一样推断出“虽然游戏没说话，但系统承认内存爆了”。这依然是**日志分析**的本职工作，只是扩展了“日志”的定义。
     3. **环境上下文 (Context Awareness)**：基于日志线索的校验。
        - *静态分析*：不搞后台监控。仅在载入日志时，顺便对比当前的硬件环境（显卡/Java版本）。
        - *一致性检查*：如果日志显示“使用集显”，但系统检测到有独显，直接在分析报告里提示“环境配置错误”。这属于**上下文中分析**，比 AI 纯读文本更准。
     4. **文件完整性校验 (File Verification)**：
        - *按需触发*：只有当日志里出现 `ZipError` 或 `ClassNotFound` 时，才去检查对应的 jar 文件头。这不是杀毒软件式的全盘扫描，而是**基于线索的精准验证**。
     5. **隐私安全**：强调 0 数据上传，对私服服主有吸引力。

7) v1.3 — 进阶工程工具箱（探索方向）
   - **差分诊断 (Diff Doctor)**：
     - *问题*：用户通常没有“正常时候的日志”作为对比基准。
     - *方案*：**云端基准库 (Cloud Baseline)**。
       - **众包采集 (Crowdsourced)**：不依赖昂贵的 API 或不稳定的爬虫。
       - *来源*：利用 MCA 的用户群体。每当有用户解析一个**成功启动无崩溃**的日志时，询问是否愿意匿名上传其环境指纹（仅 Hash/版本号，不含隐私）。
       - *激励*：上传者可获得“社区贡献者”徽章或解锁某种高级皮肤。
       - *效果*：随着用户量增加，数据库会自动覆盖所有冷门热门包，形成**自生长**的知识库。
   - **Mixin 堆栈解构 (De-obfuscator)**：
     - *痛点*：崩溃堆栈里满屏的 `handler$foo$mixincallback` 乱码，AI 看不懂。
     - *方案*：通过简单的名称映射规则（无需反编译），将乱码反解回“是 Sodium 修改了 RenderChunk”。
   - **Watchdog 时序图 (Timeline)**：
     - *痛点*：服务器卡死 (Watchdog) 时，日志是静止的。
     - *方案*：解析每一行时间戳，画出“心跳停止”前最后 60秒 的操作热力图，一眼看出是谁卡住了主线程。

任务拆解与负责人建议（占位）
- 拆分 `app.py` — Owner: @frontend-eng (建议)
- I/O 线程化与基准测试 — Owner: @perf-eng
- 正则基准与测试 — Owner: @backend-eng
- mypy 与 lint — Owner: @qa-eng
- metrics / tracing — Owner: @ops-eng

风险 / 依赖
- 许可证合规：在引入 PyVis/Echarts 等第三方库时先做 LICENSE 审核
- 兼容性：某些老 DLC 可能假设同步行为或依赖内置 `torch`，发布前需做兼容层与兼容测试

发布节拍与里程碑验收
- 里程碑频率：每 2 周一个 sprint（若资源紧张可扩成 3 周）
- 验收标准：PR 连 CI 通过 -> Demo（由指定 owner 做功能展示） -> 合并主分支 -> 更新 `CHANGELOG.md`

后续（v1.3 预告）
- Micro-kernel 阶段（分拆 `mca_lib`、CLI 与 Asyncio 改造）
- 小模型试点（微型语义模型 + 专家系统融合），优先以离线/可选 DLC 形式发布

附件与参考
- 详细需求见：`REQUIREMENTS.md`
- 发行说明和定量数据见：`CHANGELOG.md`

---